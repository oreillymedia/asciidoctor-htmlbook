<%#encoding:UTF-8%><div<%= @id && %( id="#{@id}") %> data-type="equation"<%= attr?('role') ? %( class="#{attr 'role'}") : nil %>><%
if title? %>
<h5><%= title %></h5><%
end %>
<p data-type="tex"><%
open, close = ::Asciidoctor::BLOCK_MATH_DELIMITERS[@style.to_sym]
equation = content.strip
if (@subs.nil? || @subs.empty?) && !(attr? 'subs')
  equation = sub_specialcharacters equation
end
unless (equation.start_with? open) && (equation.end_with? close)
  equation = %(#{equation})
end
%>
<%= %(#{equation}\n) %></p>
</div>